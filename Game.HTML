<html lang="en">

<head>
    <script>
        //var setup
        //var *E is a link to a HTML element
        var winEvent;
    
        var wood;
        var woodMax;
        var woodMaxInc;
        var wood4MaxWood;
        var rock4MaxWood;
        var gold4MaxWood;

        var wood4WoodPwr;
        var rock4WoodPwr;
        var gold4WoodPwr;

        var rock;
        var rockMax;
        var rockMaxInc;
        var wood4MaxRock;
        var rock4MaxRock;
        var gold4MaxRock;

        var gold;
        var goldMax;
        var goldMaxInc;
        var wood4MaxGold;
        var rock4MaxGold;
        var gold4MaxGold;
        
        var power = {
            wood,
            rock,
            gold
        };

        var homeXPos = 318;
        var homeYPos = 368;

        var playerLife;

        var gameBox;
        var monsterArray = new Array();
        var creaturePwr = 10;

        var Creature = {
            health : 0,
            imgE : null,
            xPos : 0,
            yPos : 0,
            kill : false,
            create : function(xPos,yPos){
                health = 20 * creaturePwr;
                this.xPos = xPos;
                this.yPos = yPos;
                this.imgE = document.createElement("img");
                this.imgE.src = "enemy.png";
                this.imgE.style.setProperty("position","absolute");
                this.imgE.style.setProperty("top",xPos + "px");
                this.imgE.style.setProperty("left",yPos + "px");
                gameBox.appendChild(this.imgE);

            },
            moveToHome : function(){
                var xDiff = homeXPos - this.xPos;
                var yDiff = homeYPos - this.yPos;
                
                if (xDiff == 0 & yDiff == 0 ){
                    playerLife.innerHTML = parseInt(playerLife.innerHTML) - 1;
                    gameBox.removeChild(this.imgE);
                    this.kill = true;
                    
                } else { 
                    if (xDiff < 0) {
                        this.xPos = this.xPos - 1;
                        this.imgE.style.setProperty("top",this.xPos + "px");              
                    } else if (xDiff > 0) {
                        this.xPos = this.xPos + 1;
                        this.imgE.style.setProperty("top",this.xPos + "px");
                    }
                    if (yDiff < 0) {
                        this.yPos = this.yPos - 1;
                        this.imgE.style.setProperty("left",this.yPos + "px");
                    } else if (yDiff > 0) {
                        this.yPos = this.yPos + 1;
                        this.imgE.style.setProperty("left",this.yPos + "px");
                    }
                }         
            }
        }

        var laserTower = {
            damage :  50,
            moved : false,
            towerE : null,
            xPos : 0,
            yPos : 0,
            notBuilt : true,
            intervalHandle : null,
            create : function(xPos,yPos) {
                this.xPos = xPos;
                this.yPos = yPos;
                this.towerE = document.createElement("img");
                this.towerE.src = "towerBox.png";
                this.towerE.style.setProperty("position","absolute");
                this.towerE.style.setProperty("top",xPos + "px");
                this.towerE.style.setProperty("left",yPos + "px");
                gameBox.appendChild(this.towerE);
            },
            moveTimer : function() {
                if(notBuilt) {
                    intervalHandle = setInterval("this.move()",50);
                }
            },
            move : function(){
                
            },
            builtMoveStop : function(){
                clearInterval(intervalHandle);
                notBuilt = false;
                this.imgE.src = "towerBuilt.png";
            }
        }

        var drag = {
            dragElement : function (elm) {
                var posX = 0, posY = 0, posMX = 0 , posMY = 0;
                elm.onmousedown = this.dragMouseDown;
            },
            dragMouseDown : function (e) {
                e = e || window.event;
                e.preventDefault;
                //mouse cursor grab
                posMX = e.clientX;
                posMY = e.clientY;
                document.onmouseup = this.closeDragElement;
                document.onmousemove = this.elementDrag;
            },
            elementDrag : function (e) {
                e = e || window.event;
                e.preventDefault;
                //calc new position
                posX = posMX - e.clientX;
                posY = posMY - e.clientY;
                posMX = e.clientX;
                posMY = e.clientY;
                //set element new
                elm.style.top = (elmnt.offsetTop - posY) + "px";
                elm.style.left = (elmnt.offsetLeft - posX) + "px";
            },
            dragClose : function() {
                document.onmouseup = null;
                document.onmousemove = null;
            }

        }

        var warningE;
    
        var minutes;
        var seconds;
        var bestMin;
        var bestSec;

        var costplus = 1.4;

        function treeClick() { increaseX(parseInt(power.wood.innerHTML),wood,woodMax); }
        function rockClick() { increaseX(parseInt(power.rock.innerHTML),rock,rockMax); }
        function goldClick() { increaseX(parseInt(power.gold.innerHTML),gold,goldMax); }

        function increaseX(i,resource,resMax) {
            //increases gold resource, checks if above Max and stops if so
            var begin = resource;
            var Max = resMax;
            var Cur = parseInt(begin.innerHTML) + i;

            if (Cur > parseInt(Max.innerHTML)) {
                begin.innerHTML = parseInt(Max.innerHTML);
            } else {
                begin.innerHTML = Cur;
            }

        }

        function increaseValHTML(value,increment,wcost,rcost,gcost,incrGrowth) {
            //check if affordable
            if ( payCost(wcost,rcost,gcost) ) {
                value.innerHTML = parseInt(value.innerHTML) + increment;
                increment = increment + incrGrowth;
            }
        }

        //returns true if paid
        function payCost(wcost,rcost,gcost) {
            var woodcostHold = parseInt(wcost.innerHTML);
            var rockcostHold = parseInt(rcost.innerHTML);
            var goldcostHold = parseInt(gcost.innerHTML);

            if(woodcostHold <= parseInt(wood.innerHTML) && rockcostHold <= parseInt(rock.innerHTML) && goldcostHold <= parseInt(gold.innerHTML) ) {
                //pay
                increaseX((woodcostHold * -1),wood,woodMax);
                increaseX((rockcostHold * -1),rock,rockMax);
                increaseX((goldcostHold * -1),gold,goldMax);
                //increment values
                
                wcost.innerHTML = parseInt(woodcostHold * costplus);
                rcost.innerHTML = parseInt(rockcostHold * costplus);
                gcost.innerHTML = parseInt(goldcostHold * costplus);
                
                return true;

            } else {
                warningE.innerHTML = "cannot afford";
                setTimeout(warningReset,600)
                return false;
            }

        }

        function WoodMaxClick() {
            increaseValHTML(woodMax,woodMaxInc,wood4MaxWood,rock4MaxWood,gold4MaxWood,5);
        }
        function RockMaxClick() {
            increaseValHTML(rockMax,rockMaxInc,wood4MaxRock,rock4MaxRock,gold4MaxRock,5);
        }
        function GoldMaxClick() {
            increaseValHTML(goldMax,goldMaxInc,wood4MaxGold,rock4MaxGold,gold4MaxGold,3);
        }

        function WoodPowerInc() {
            increaseValHTML(power.wood,1,wood4WoodPwr,rock4WoodPwr,gold4WoodPwr);
        }
        function RockPowerInc() {
            increaseValHTML(power.rock,1,wood4RockPwr,rock4RockPwr,gold4RockPwr);
        }
        function GoldPowerInc() {
            increaseValHTML(power.gold,1,wood4GoldPwr,rock4GoldPwr,gold4GoldPwr);
        }

        function warningReset() { warningE.innerHTML = "";}
    
        function restartGame() {
            wood.innerHTML = 0;
            woodMax.innerHTML = 25;
            rock.innerHTML = 0;
            rockMax.innerHTML = 25;
            gold.innerHTML = 0;
            goldMax.innerHTML = 22;

            woodMaxInc = 5;
            rockMaxInc = 5;
            goldMaxInc = 5;

            power.wood.innerHTML = 2;
            power.rock.innerHTML = 2;
            power.gold.innerHTML = 2;

            minutes.innerHTML = 0;
            seconds.innerHTML = 0;

            //creature test
            monsterArray.push(Object.create(Creature));
            monsterArray[0].create(160,220);
            monsterArray.push(Object.create(Creature));
            monsterArray[1].create(190,280);
            //tower test
            var tower = Object.create(laserTower);
            tower.create(200,400)
            drag.dragElement(tower.towerE);
            
        }

        //remove 
        function tickTest() {
            //monsterArray[0].moveToHome();
            setInterval("gameLogicTick()",70);
        }

        function firstStart() {
        
            wood = window.document.getElementById("wood"); 
            woodMax = window.document.getElementById("woodMax"); 
            rock = window.document.getElementById("rock");
            rockMax = window.document.getElementById("rockMax"); 
            gold = window.document.getElementById("gold"); 
            goldMax = window.document.getElementById("goldMax"); 

            power.wood = document.getElementById("woodPwr");
            power.rock = document.getElementById("rockPwr");
            power.gold = document.getElementById("goldPwr");

            wood4MaxWood = document.getElementById("wood4MaxWood");
            rock4MaxWood = document.getElementById("rock4MaxWood");
            gold4MaxWood = document.getElementById("gold4MaxWood");

            wood4WoodPwr = document.getElementById("wood4WoodPwr");
            rock4WoodPwr = document.getElementById("rock4WoodPwr");
            gold4WoodPwr = document.getElementById("gold4WoodPwr");

            wood4MaxRock = document.getElementById("wood4MaxRock");
            rock4MaxRock = document.getElementById("rock4MaxRock");
            gold4MaxRock = document.getElementById("gold4MaxRock");

            wood4MaxGold = document.getElementById("wood4MaxGold");
            rock4MaxGold = document.getElementById("rock4MaxGold");
            gold4MaxGold = document.getElementById("gold4MaxGold");

            playerLife = document.getElementById("life");
            gameBox = document.getElementById("box");
            creaturePwr = 10;

            warningE = document.getElementById("warning");

            seconds = window.document.getElementById("sec"); 
            minutes = window.document.getElementById("min");
            bestMin = window.document.getElementById("bestmin");
            bestSec = window.document.getElementById("bestsec");

            alert("Begin the game.");
            setInterval ("timeInc()",1000);
            restartGame();

        }

        //loop for 
        function gameLogicTick() {
            //movement of creatures
            var monALen = monsterArray.length;
            for (i = 0; i < monALen; i++) {
                if(monsterArray[i] != null) {
                    monsterArray[i].moveToHome();
                }
            }
            //remove creatures once arrived at home
            for (i = 0; i < monALen; i++) {
                if(monsterArray[i] != null) {
                    if (monsterArray[i].kill) {
                        monsterArray[i] = null;
                    }
                }     
            }
        }

        //increases play timer
        function timeInc() {
            var Current = parseInt(seconds.innerHTML) + 1;
            if (Current >= 60) {
                minutes.innerHTML = parseInt(minutes.innerHTML) + 1;
                seconds.innerHTML = 0;
            } else {
                seconds.innerHTML = Current;
            }
        }
            
        function bestTimeCheck() {
            
        }
  
    </script>
</head>

<style>
    .mainSize {
        height: 60px;
        width: 802px;
        display: inline-block;
    }

    .boxSize {
        border: 1px solid black;
        max-width: 800px;
        min-height: 500px
    }

    .bottomBtn {
        background-color: rgb(151, 119, 76);
        color: white;
        padding: 5px 5px 5px 5px;
        font-size: 16px;
        border: 2px solid black;
    }

    .bottomBtn2 {
        background-color: rgb(207, 157, 90);
    }

    .clickButton {
        height: 32px;
        width: 32px;
        position: relative;
        top: 50px;
        left: 120px;
        border-radius: 6px;
        color: white;
    }

    .clickButtonWood{ border: 1px solid darkgreen; }
    .clickButtonrRock{ 
        border: 1px solid darkgray;
        top: 80px;
        left: 680px;
        }
    .clickButtonGold{ 
        border: 1px solid gold;
        top: 380px;
        left: 98px;
        }

    .warning {
        font-size: 16px;
        color: red;
    
    }

</style>

<body onLoad="firstStart()">
    <div class="mainSize" style="background-color:rgb(85, 158, 182);">
        <span style="font-size: large; font-weight: bolder;text-indent: 8px">--A Game--</span> <span style="padding-left: 20px" id="life">20</span> <img src="heart.png" height="16px">
        <span style="padding-left: 260px"> <button onclick="restartGame()">Restart</button>
        <span id="min" style="padding-left: 40px">0</span>
        <span>min</span>
        <span id="sec" >0</span>
        <span>s</span>
        <button onClick="tickTest()">tick</button>
        <span style="padding-left: 40px">Best:</span>
        <span id="bestmin" style="padding-left: 20px">0</span>
        <span>min</span>
        <span id="bestsec" >0</span>
        <span>s</span>
        <BR><BR>
        <span style="padding-left: 8px;font-weight: bolder">Wood: </span> <span>(+</span> <span id="woodPwr">2</span> <span>)</span>
            <span id="wood">0</span> <span>/</span> <span id="woodMax">20</span>
        <img src="woodRes.png">
        <span style="padding-left: 8px;font-weight: bolder">Rock: </span> <span>(+</span> <span id="rockPwr">2</span> <span>)</span>
            <span id="rock">0</span> <span>/</span> <span id="rockMax">30</span>
        <img src="rockRes.png">
        <span style="padding-left: 8px;font-weight: bolder">Gold: </span> <span>(+</span> <span id="goldPwr">2</span> <span>)</span>
            <span id="gold">0</span> <span>/</span> <span id="goldMax">30</span>
        <img src="goldRes.png">
        <span style="padding-left: 360px"> </span>
        
    </div><BR>

    <span id="box" height="360" width="600" class="boxSize" style="display: block">
        <img id="home" src="House.png" style="position: absolute; top: 318px; left: 368px;">
        <button id="treeBtn" class="clickButton clickButtonWood" style="background: url('tree.png')" onclick="treeClick()">W</button>
        <button id="rockBtn" class="clickButton clickButtonrRock" style="background: url('rock.png')" onclick="rockClick()">R</button>
        <button id="goldBtn" class="clickButton clickButtonGold" style="background: url('gold.png')" onclick="goldClick()">G</button>
    </span>

    <div class="mainSize" style="background-color:rgb(104, 78, 45); height: 200px;">
        <BR>
            <span style="padding-left: 8px"></span>
        <button class="bottomBtn" onclick="WoodMaxClick()">WoodMax+</button>
        <span id="wood4MaxWood" >2</span>
        <img src="woodRes.png">
        <span id="rock4MaxWood">4</span>
        <img src="rockRes.png">
        <span id="gold4MaxWood">3</span>
        <img src="goldRes.png">

        <button class="bottomBtn" onclick="RockMaxClick()">RockMax+</button>
        <span id="wood4MaxRock">4</span>
        <img src="woodRes.png">
        <span id="rock4MaxRock">2</span>
        <img src="rockRes.png">
        <span id="gold4MaxRock">5</span>
        <img src="goldRes.png">

        <button class="bottomBtn" onclick="GoldMaxClick()">GoldMax+</button>
        <span id="wood4MaxGold">2</span>
        <img src="woodRes.png">
        <span id="rock4MaxGold">6</span>
        <img src="rockRes.png">
        <span id="gold4MaxGold">7</span>
        <img src="goldRes.png">  <BR>

            <span style="padding-left: 8px"></span>
        <button class="bottomBtn bottomBtn2" onclick="WoodPowerInc()">WoodPwr+</button>
        <span id="wood4WoodPwr">3</span>
        <img src="woodRes.png">
        <span id="rock4WoodPwr">6</span>
        <img src="rockRes.png">
        <span id="gold4WoodPwr">6</span>
        <img src="goldRes.png">

        <button class="bottomBtn bottomBtn2" onclick="RockPowerInc()">RockPwr+</button>
        <span id="wood4RockPwr">5</span>
        <img src="woodRes.png">
        <span id="rock4RockPwr">3</span>
        <img src="rockRes.png">
        <span id="gold4RockPwr">7</span>
        <img src="goldRes.png">

        <button class="bottomBtn bottomBtn2" onclick="GoldPowerInc()">GoldPwr+</button>
        <span id="wood4GoldPwr">10</span>
        <img src="woodRes.png">
        <span id="rock4GoldPwr">8</span>
        <img src="rockRes.png">
        <span id="gold4GoldPwr">2</span>
        <img src="goldRes.png">

        <BR>
        <span class="warning" id="warning"></span>

    </div>    

</body>
</html>